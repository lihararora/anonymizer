<!DOCTYPE html>
<html lang="en">
	<head>
    	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
    	<title>Explorer</title>

    	<!-- Bootstrap -->
    	<link href="/static/webapp/css/main.css" rel="stylesheet">
    	<link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    	<link href="/static/webapp/css/editor.css" rel="stylesheet">
    	<script type="text/javascript" src="/static/bootstrap/js/jquery-2.1.0.min.js"></script>
    	<script type="text/javascript" src="/static/bootstrap/js/jquery.hotkeys.js"></script>
    	<script type="text/javascript" src="/static/bootstrap/js/slimscroll.js"></script>
    	<script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>
    	<style type="text/css">
    		.entity_row:HOVER td
    		{
    			background-color: #ccc !important;
    			cursor: pointer;
    		}
    	</style>
  	</head>
  	<body>
		<div class="container-fluid">
			<div class="row">
				<nav class="navbar navbar-default navbar-static-top" role="navigation">
					<div class="container-fluid">
					    <!-- Brand and toggle get grouped for better mobile display -->
						<div class="navbar-header">
						  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						    <span class="sr-only">Toggle navigation</span>
						    <span class="icon-bar"></span>
						    <span class="icon-bar"></span>
						    <span class="icon-bar"></span>
						  </button>
						  <a class="navbar-brand" style="font-size: 26px" href="/explorer/">Anonymizer</a>
						</div>
						
						<!-- Collect the nav links, forms, and other content for toggling -->
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="z-index: 1000 !important">
							<ul class="nav navbar-nav">
						      <li><a href="#" data-toggle="modal" data-target="#newform"><span style="top: 2px" class="glyphicon glyphicon-plus-sign"></span>  New</a></li>
						    </ul>
						    <ul class="nav navbar-nav">
						      <li><a href="#" data-toggle="modal" data-target="#saveform"><span style="top: 2px" class="glyphicon glyphicon-floppy-disk"></span>  Save</a></li>   
						    </ul>
							<button type="button" style="margin-left:20px" class="navbar-right btn btn-default btn-sm navbar-btn" onclick="window.location='/logout/'">Sign out</button>
							<p class="navbar-text navbar-right"><a href="#" class="navbar-link">{{ request.session.firstname }} {{ request.session.lastname }}</a></p>
						</div><!-- /.navbar-collapse -->
					</div><!-- /.container-fluid -->
				</nav>
			</div>
			<div class="row">
				<div class="col-md-5" style="height: 500px;">
					<div class="btn-toolbar btn-inverse" style="margin-bottom: 10px;" data-role="editor-toolbar" data-target="#editor">
						<div class="btn-group">
						  <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font"><i class="glyphicon glyphicon-font"></i><b class="caret"></b></a>
						    <ul class="dropdown-menu">
						    <li><a data-edit="fontName Serif" style="font-family:'Serif'">Serif</a></li><li><a data-edit="fontName Sans" style="font-family:'Sans'">Sans</a></li><li><a data-edit="fontName Arial" style="font-family:'Arial'">Arial</a></li><li><a data-edit="fontName Arial Black" style="font-family:'Arial Black'">Arial Black</a></li><li><a data-edit="fontName Courier" style="font-family:'Courier'">Courier</a></li><li><a data-edit="fontName Courier New" style="font-family:'Courier New'">Courier New</a></li><li><a data-edit="fontName Comic Sans MS" style="font-family:'Comic Sans MS'">Comic Sans MS</a></li><li><a data-edit="fontName Helvetica" style="font-family:'Helvetica'">Helvetica</a></li><li><a data-edit="fontName Impact" style="font-family:'Impact'">Impact</a></li><li><a data-edit="fontName Lucida Grande" style="font-family:'Lucida Grande'">Lucida Grande</a></li><li><a data-edit="fontName Lucida Sans" style="font-family:'Lucida Sans'">Lucida Sans</a></li><li><a data-edit="fontName Tahoma" style="font-family:'Tahoma'">Tahoma</a></li><li><a data-edit="fontName Times" style="font-family:'Times'">Times</a></li><li><a data-edit="fontName Times New Roman" style="font-family:'Times New Roman'">Times New Roman</a></li><li><a data-edit="fontName Verdana" style="font-family:'Verdana'">Verdana</a></li></ul>
						  </div>
						<div class="btn-group">
						  <a class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font Size"><i class="glyphicon glyphicon-text-height"></i>&nbsp;<b class="caret"></b></a>
						    <ul class="dropdown-menu">
						    <li><a data-edit="fontSize 5"><font size="5">Huge</font></a></li>
						    <li><a data-edit="fontSize 3"><font size="3">Normal</font></a></li>
						    <li><a data-edit="fontSize 1"><font size="1">Small</font></a></li>
						    </ul>
						</div>
						<div class="btn-group">
						  <a class="btn btn-default btn-sm" data-edit="bold" title="" data-original-title="Bold (Ctrl/Cmd+B)"><i class="glyphicon glyphicon-bold"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="italic" title="" data-original-title="Italic (Ctrl/Cmd+I)"><i class="glyphicon glyphicon-italic"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="underline" title="" data-original-title="Underline (Ctrl/Cmd+U)"><i class="glyphicon glyphicon-magnet"></i></a>
						</div>
						<div class="btn-group">
						  <a class="btn btn-default btn-sm" data-edit="insertunorderedlist" title="" data-original-title="Bullet list"><i class="glyphicon glyphicon-th-list"></i></a>
						</div>
						<div class="btn-group">
						  <a class="btn btn-default btn-sm btn-info" data-edit="justifyleft" title="" data-original-title="Align Left (Ctrl/Cmd+L)"><i class="glyphicon glyphicon-align-left"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="justifycenter" title="" data-original-title="Center (Ctrl/Cmd+E)"><i class="glyphicon glyphicon-align-center"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="justifyright" title="" data-original-title="Align Right (Ctrl/Cmd+R)"><i class="glyphicon glyphicon-align-right"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="justifyfull" title="" data-original-title="Justify (Ctrl/Cmd+J)"><i class="glyphicon glyphicon-align-justify"></i></a>
						</div>
						<div class="btn-group">
						  <a class="btn btn-default btn-sm" data-edit="undo" title="" data-original-title="Undo (Ctrl/Cmd+Z)"><i class="glyphicon glyphicon-repeat flipped"></i></a>
						  <a class="btn btn-default btn-sm" data-edit="redo" title="" data-original-title="Redo (Ctrl/Cmd+Y)"><i class="glyphicon glyphicon-repeat"></i></a>
						</div>
						<div class="btn-group" style="float: right;">
						  <a class="btn btn-danger btn-sm" title="" data-original-title="" href="javascript:replaceSelectedText('level_1');">Level 1</a>
						  <a class="btn btn-warning btn-sm" title="" data-original-title="" href="javascript:replaceSelectedText('level_2');">Level 2</a>
						  <a class="btn btn-info btn-sm" title="" data-original-title="" href="javascript:replaceSelectedText('level_3');" >Level 3</a>
						</div>
				    </div>
					<div id="editor">{{ file_contents|safe }}</div>
				</div>
  				<div class="col-md-3" style="height: 500px;">
					<table class="table table-striped" style="margin-bottom: 0px">
							<tr style="margin-bottom: 10px;" class="success">
								<td style="width: 42% !important">Entity</th>
								<td style="width: 38% !important">Type</th>
								<td style="width: 20% !important">Sensitivity</th>
							</tr>
					</table>
					<div id="entity_scroll">
						<table class="table table-striped">
							{% for entity in named_entities %}
								<tr class="entity_row" id="entity_row_{{ entity.id }}" onclick="select(this)">
									<td style="width: 40% !important">{{entity.name}}</td>
									<td style="width: 40% !important">{{entity.type}}</td>
									<td style="width: 20% !important">{{entity.sensitivity}}</td>
								</tr>
							{% endfor %}
						</table>
					</div>
				</div>
			</div>
		</div>
		<div class="modal" id="newform">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		        <h4 class="modal-title">New Document</h4>
		      </div>
		      <form action="/editor/" method="post" enctype="multipart/form-data">
			      <div class="modal-body">
			        <p>Select a document to upload <input class="btn btn-primary" style="display: inline;" type="file" name='file' value="Choose File"/> </p>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			        <button type="submit" class="btn btn-primary">Upload</button>
			      </div>
			   </form>
		    </div>
		  </div>
		</div>
		<div class="modal" id="saveform">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		        <h4 class="modal-title">Save Document</h4>
		      </div>
		      <form action="/save/" method="post" onsubmit="getContent()">
			      <div class="modal-body">
			        <div class="form-group">
					  <label class="control-label" for="focusedInput">Filename</label>
					  <input class="form-control" id="focusedInput" name="filename" type="text" value="">
					  <input type="hidden" id="content" name="content" value="">
					</div>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			        <button type="submit" class="btn btn-primary">Save</button>
			      </div>
			   </form>
		    </div>
		  </div>
		</div>
		<script type="text/javascript" src="/static/webapp/js/editor.js"></script>
		<script type="text/javascript">
	    	$("#editor").wysiwyg();
	    	$('#editor').slimScroll({
	    	    railVisible: true,
	    	    alwaysVisible: true
	        });
	    	$('#entity_scroll').slimScroll({
	    	    railVisible: true,
	    	    alwaysVisible: true
	        });
	    	
	    	function getContent()
	    	{
	    		var c;
	    		c = document.getElementById('editor').innerHTML;
	    		document.getElementById('content').value = c;
	    		return true;
	    	}
	    	
	    	function select(row)
	    	{
	    		var row_id = row.id;
	    		var element = row_id.replace("entity_row_","entity")
	    		var doc = document
			        , text = doc.getElementById(element)
			        , range, selection
			    ;    
			    if (doc.body.createTextRange) { //ms
			        range = doc.body.createTextRange();
			        range.moveToElementText(text);
			        range.select();
			    } else if (window.getSelection) { //all others
			        selection = window.getSelection();        
			        range = doc.createRange();
			        range.selectNodeContents(text);
			        selection.removeAllRanges();
			        selection.addRange(range);
			    }
			    
			    $('#editor').animate({
			        scrollTop: $("#"+element).parent().scrollTop() + $("#"+element).offset().top - $("#"+element).parent().offset().top - 50
			    }, {
			        duration: 500,
			        specialEasing: {
			            width: 'linear',
			            height: 'easeOutBounce'
			        }
			    });
			    //var eleobj = document.getElementById(element)
			    //eleobj.parentNode.scrollTop = eleobj.offsetTop - eleobj.parentNode.offsetTop;
			    //$('#editor').animate({scrollTop: $("#"+element).offset().top - $("#editor").offset().top}, 800);
	    	}
	    </script>
	</body>
</html>